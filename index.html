<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Chrono HIIT & Tabata</title>

<link rel="manifest" href="/manifest.webmanifest">

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: Arial, sans-serif;
    color: #fff;
    overflow: hidden;
    background: #111;
}

/* PHASE BACKGROUNDS */
body.work { background: #c1121f; }
body.rest { background: #2d6a4f; }
body.seriesRest { background: #f4a261; }
body.idle { background: #111; }

/* FLASH WARNING */
@keyframes flash {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}
body.flash-warning {
    animation: flash 0.5s ease-in-out;
}

#app {
    min-height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
}

/* SETTINGS PANEL */
.settings {
    background: rgba(0,0,0,0.5);
    padding: 14px;
    border-radius: 10px;
    width: min(320px, 90vw);
}
label {
    font-size: 13px;
    display: block;
    margin-top: 6px;
}
input, select {
    width: 100%;
    padding: 6px;
    margin-top: 3px;
    border-radius: 5px;
    border: none;
    box-sizing: border-box;
}

button {
    padding: 8px 10px;
    margin-top: 8px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
    width: 100%;
}
.start { background: #000; color: #fff; }
.stop { background: #444; color: #fff; }

/* ROTATE BUTTON â€” EN BAS Ã€ GAUCHE */
.rotate-btn {
    position: fixed;
    bottom: 10px;
    left: 10px;
    background: none;
    border: none;
    color: #fff;
    font-size: 24px;
    cursor: pointer;
    z-index: 10;
    transform: rotate(0deg);
    transition: transform 0.2s ease;
}
.rotate-btn:hover {
    transform: rotate(10deg);
}

/* TIMER DISPLAY */
#rotate-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s;
}
.timer {
    font-weight: bold;
    font-size: clamp(80px, 20vw, 120px);
    margin-bottom: 12px;
}
.info {
    margin-top: 8px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}

/* PROGRESS BAR */
.progress {
    width: min(320px, 90vw);
    height: 14px;
    background: rgba(255,255,255,0.2);
    border-radius: 20px;
    overflow: hidden;
    margin-top: 12px;
}
.progress-bar {
    height: 100%;
    width: 0%;
    transition: width 0.2s linear;
}
body.work .progress-bar { background: #ffb703; }
body.rest .progress-bar { background: #95d5b2; }
body.seriesRest .progress-bar { background: #ffd166; }

/* ROTATE MODE */
body.rotate-mode #rotate-container {
    transform: rotate(90deg);
}
body.rotate-mode .settings {
    display: none;
}

/* CREDIT EN HAUT Ã€ DROITE */
.credit {
    position: fixed;
    top: 8px;
    right: 10px;
    font-size: 12px;
    color: rgba(255,255,255,0.7);
    text-align: right;
    z-index: 5;
}
.credit a {
    color: #ddd;
    text-decoration: none;
}
</style>
</head>
<body class="idle">
<div id="app">

<div class="settings">
    <label>Preset</label>
    <select id="presetList" onchange="loadPreset()">
        <option value="">Charger un preset</option>
    </select>

    <label>Exos / Tours</label>
    <input id="series" type="number" value="8" min="1">

    <label>Effort (mm:ss)</label>
    <div style="display:flex; gap:4px;">
        <input id="workMin" type="number" value="0" min="0">
        <input id="workSec" type="number" value="20" min="0">
    </div>

    <label>Repos (mm:ss)</label>
    <div style="display:flex; gap:4px;">
        <input id="restMin" type="number" value="0" min="0">
        <input id="restSec" type="number" value="10" min="0">
    </div>

    <label>Repos / SÃ©ries (mm:ss)</label>
    <div style="display:flex; gap:4px;">
        <input id="seriesRestMin" type="number" value="1" min="0">
        <input id="seriesRestSec" type="number" value="0" min="0">
    </div>

    <label>Nombre de sÃ©ries</label>
    <input id="tours" type="number" value="1" min="1">

    <button class="start" onclick="startPause()">Start / Pause</button>
    <button class="stop" onclick="reset()">Stop</button>
</div>

<div id="rotate-container">
    <div class="timer" id="timer">00:00</div>
    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div id="totalRemaining" style="font-size:12px; color:#ddd; margin-top:4px;">Total restant: 00:00</div>
    <div class="info" id="info">Serie 0 / 0 â€” Exo 0 / 0</div>
</div>

<button class="rotate-btn" onclick="toggleRotate()">ðŸ”„</button>

<div class="credit">
    <a href="https://sites.google.com/view/younes-personal-trainer" target="_blank" rel="noopener">Younes Personal Trainer</a>
</div>

</div>

<script>
let interval=null,countdownInterval=null,phase="idle",timeLeft=0,phaseDuration=0,seriesCount=1,toursCount=1,started=false,paused=false,wakeLock=null,audioContext=null;const basePresets=[{name:"Randori JJB 5/1 x5",tours:1,series:5,workMin:5,workSec:0,restMin:1,restSec:0,seriesRestMin:1,seriesRestSec:0},{name:"30/30 x5 x4",tours:4,series:5,workMin:0,workSec:30,restMin:0,restSec:30,seriesRestMin:1,seriesRestSec:30}];function loadPresetList(){const s=document.getElementById("presetList"),c=s.value;s.innerHTML='<option value="">Charger un preset</option>';basePresets.forEach(p=>{const o=document.createElement("option");o.value=p.name,o.textContent=p.name,s.appendChild(o)}),s.value=c}function loadPreset(){const n=document.getElementById("presetList").value;if(!n)return;const p=basePresets.find(x=>x.name===n);if(!p)return;document.getElementById("tours").value=p.tours,document.getElementById("series").value=p.series,document.getElementById("workMin").value=p.workMin,document.getElementById("workSec").value=p.workSec,document.getElementById("restMin").value=p.restMin,document.getElementById("restSec").value=p.restSec,document.getElementById("seriesRestMin").value=p.seriesRestMin,document.getElementById("seriesRestSec").value=p.seriesRestSec,updateTotalRemaining()}function getSeconds(minId,secId){return(parseInt(document.getElementById(minId).value)||0)*60+(parseInt(document.getElementById(secId).value)||0)}function formatTime(s){const sec=Math.max(0,s),m=Math.floor(sec/60),se=sec%60;return`${m.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`}function beep(f=800,d=0.1){try{audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext)),o=audioContext.createOscillator(),g=audioContext.createGain(),o.connect(g),g.connect(audioContext.destination),o.frequency.value=f,g.gain.value=.3,o.start(),o.stop(audioContext.currentTime+d)}catch(e){console.warn("Beep non supportÃ©")}}function say(text){if(!window.speechSynthesis)return;try{const u=new SpeechSynthesisUtterance(text);u.lang="en-US",u.pitch=.3,u.rate=.85;const voices=speechSynthesis.getVoices(),v=voices.find(v=>v.lang.startsWith("en")&&(v.name.includes("Male")||v.name.includes("Daniel")||v.name.includes("Alex")||v.name.includes("Fred")));v&&(u.voice=v),speechSynthesis.speak(u)}catch(e){console.warn("SynthÃ¨se vocale non supportÃ©e")}}async function requestWakeLock(){"wakeLock"in navigator&&!wakeLock&&(wakeLock=await navigator.wakeLock.request("screen").catch(()=>{}))}async function releaseWakeLock(){wakeLock&&(await wakeLock.release().catch(()=>{}),wakeLock=null)}document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&started&&!paused&&requestWakeLock()});async function startPause(){started?(paused=!paused,!paused&&(beep(600,.2),await requestWakeLock())):(await requestWakeLock(),started=!0,paused=!1,countdown())}function countdown(){let c=3;document.getElementById("timer").textContent=c+":00",document.getElementById("info").textContent="Get ready...",say("Get ready"),beep(400,.1),countdownInterval=setInterval(()=>{if(!paused){if(c--,c>0)document.getElementById("timer").textContent=c+":00",say(c),beep(400,.1);else clearInterval(countdownInterval),say("GO!"),beep(1e3,.3),initWorkout()}},1e3)}function initWorkout(){toursCount=1,seriesCount=1,phase="work",phaseDuration=timeLeft=getSeconds("workMin","workSec"),setPhase(),runLoop()}function runLoop(){clearInterval(interval),interval=setInterval(()=>{if(!paused){timeLeft<=3&&timeLeft>0&&(document.body.classList.add("flash-warning"),beep(1200,.1),setTimeout(()=>document.body.classList.remove("flash-warning"),500)),document.getElementById("timer").textContent=formatTime(timeLeft),updateTotalRemaining(),updateProgress(),timeLeft--,timeLeft<0&&nextPhase()}},1e3)}function nextPhase(){const W=getSeconds("workMin","workSec"),R=getSeconds("restMin","restSec"),SR=getSeconds("seriesRestMin","seriesRestSec"),S=parseInt(document.getElementById("series").value)||1,T=parseInt(document.getElementById("tours").value)||1;"work"===phase?seriesCount<S?(phase="rest",timeLeft=phaseDuration=R,say("Rest"),beep(600,.2)):toursCount<T?(toursCount++,seriesCount=0,phase="seriesRest",timeLeft=phaseDuration=SR,say("Break time"),beep(500,.3)):(say("Workout complete. Well done!"),beep(1e3,.5),reset()):"rest"===phase?(seriesCount++,phase="work",timeLeft=phaseDuration=W,say(`Round ${seriesCount}`),beep(1e3,.2)):"seriesRest"===phase&&(seriesCount=1,phase="work",timeLeft=phaseDuration=W,say(`Series ${toursCount}. Round ${seriesCount}`),beep(1e3,.3)),setPhase()}function setPhase(){const r=document.body.classList.contains("rotate-mode");document.body.className=phase+(r?" rotate-mode":""),document.getElementById("info").textContent=`Serie ${toursCount} / ${document.getElementById("tours").value} â€” Exo ${seriesCount} / ${document.getElementById("series").value}`,updateProgress(!0)}function updateProgress(reset=!1){const b=document.getElementById("progressBar");b.style.width=reset?"0%":phaseDuration>0?Math.min(100,Math.max(0,(phaseDuration-timeLeft)/phaseDuration*100))+"%":"0%"}function updateTotalRemaining(){let rem=0;if("idle"===phase){const t=parseInt(document.getElementById("tours").value)||1,s=parseInt(document.getElementById("series").value)||1,w=getSeconds("workMin","workSec"),r=getSeconds("restMin","restSec"),sr=getSeconds("seriesRestMin","seriesRestSec");rem=t*(s*w+(s-1)*r+sr)-sr}else{const t=parseInt(document.getElementById("tours").value)||1,s=parseInt(document.getElementById("series").value)||1,w=getSeconds("workMin","workSec"),r=getSeconds("restMin","restSec"),sr=getSeconds("seriesRestMin","seriesRestSec");rem+=Math.max(timeLeft,0),"work"===phase?rem+=(s-seriesCount)*(w+r):"rest"===phase&&(rem+=(s-seriesCount)*(w+r)+w),toursCount<t&&(rem+=sr,"seriesRest"===phase&&(rem-=sr,rem+=(s-1)*(w+r)+w),rem+=(t-toursCount-1)*(s*w+(s-1)*r+sr)+s*w+(s-1)*r),"seriesRest"===phase&&(rem+=(s-1)*(w+r)+w)}document.getElementById("totalRemaining").textContent=`Total restant: ${formatTime(rem)}`}async function reset(){clearInterval(interval),clearInterval(countdownInterval),started=!1,paused=!1,phase="idle";const r=document.body.classList.contains("rotate-mode");document.body.className="idle"+(r?" rotate-mode":""),document.getElementById("timer").textContent="00:00",document.getElementById("info").textContent="Serie 0 / 0 â€” Exo 0 / 0",document.getElementById("progressBar").style.width="0%",updateTotalRemaining(),await releaseWakeLock()}function toggleRotate(){document.body.classList.toggle("rotate-mode")}window.speechSynthesis&&speechSynthesis.getVoices(),loadPresetList(),updateTotalRemaining(),["series","workMin","workSec","restMin","restSec","seriesRestMin","seriesRestSec","tours"].forEach(id=>{document.getElementById(id).addEventListener("input",updateTotalRemaining)});
</script>
</body>
</html>



